---
import Layout from "@layouts/Layout.astro";
---

<Layout title="Contact">
  <section
    class="bg-contact-color-bg text-zinc-700 flex justify-center items-center flex-col w-full pt-[96px]"
  >
    <h2
      class="flex justify-center p-10 text-3xl items-center text-center text-light-blue"
    >
      Get in touch with us
    </h2>
    <form id="contactForm" class="justify-center items-center w-full sm:w-3/4">
      <div class="flex w-full flex-col gap-y-5 px-10">
        <div
          class="flex flex-col gap-y-5 sm:gap-y-0 sm:flex-row justify-between gap-x-10"
        >
          <div class="flex flex-col w-full">
            <label for="nombre">Name:</label>
            <input
              type="text"
              id="nombre"
              name="nombre"
              placeholder="Your name..."
              class="bg-transparent p-2 border-b-[2px] border-slate-400 focus:outline-none focus:border-black transition-colors w-full"
            />
          </div>
          <div class="flex flex-col w-full">
            <label for="email">Email:</label>
            <input
              type="text"
              id="email"
              name="email"
              placeholder="Your email..."
              class="bg-transparent p-2 border-b-[2px] border-slate-400 focus:outline-none focus:border-black transition-colors w-full"
            />
          </div>
          <div class="flex flex-col w-full">
            <label for="number">Phone number:</label>
            <input
              type="tel"
              id="number"
              name="number"
              placeholder="Your phone number..."
              class="bg-transparent p-2 border-b-[2px] border-slate-400 focus:outline-none focus:border-black transition-colors w-full"
            />
          </div>
        </div>
        <div class="flex flex-col justify-center items-center">
          <label class="self-start" for="mensaje">Mensaje:</label>
          <textarea
            id="mensaje"
            name="mensaje"
            placeholder="Your message..."
            class="bg-transparent p-2 border-b-[2px] border-slate-400 focus:outline-none focus:border-black transition-colors w-full"
          ></textarea>
          <button
            type="submit"
            class="bg-light-blue text-white flex justify-center items-center p-2 rounded-md hover:opacity-90 transition-opacity my-5 w-40"
          >
            Enviar
          </button>
        </div>
      </div>
    </form>
  </section>

  <script>
    import Toastify from "toastify-js";
    document
      .getElementById("contactForm")
      .addEventListener("submit", async function (event) {
        event.preventDefault();

        const nombre = (document.getElementById("nombre") as HTMLInputElement)
          .value;
        const mensaje = (
          document.getElementById("mensaje") as HTMLTextAreaElement
        ).value;
        const email = (document.getElementById("email") as HTMLInputElement)
          .value;
        const tel = (document.getElementById("number") as HTMLInputElement)
          .value;

        const data = {
          name: nombre,
          msg: mensaje,
          email: email,
          tel: tel,
        };

        // Mostrar toast de carga
        const loadingToast = Toastify({
          text: "Enviando mensaje...",
          duration: -1,
          close: true,
          gravity: "top",
          position: "right",
          backgroundColor: "#3498db",
        }).showToast();

        try {
          const response = await fetch(
            "https://contact-app-murex.vercel.app/afw/send-mail",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            }
          );

          // Cerrar el toast de carga
          loadingToast.hideToast();

          if (response.ok) {
            // Mostrar toast de Ã©xito
            Toastify({
              text: "Mensaje enviado exitosamente.",
              duration: 3000,
              gravity: "top",
              position: "right",
              backgroundColor: "#28a745",
            }).showToast();

            // Vaciar los campos del formulario
            (document.getElementById("contactForm") as HTMLFormElement).reset();
          } else {
            // Mostrar toast de error
            Toastify({
              text: "Hubo un error al enviar el mensaje.",
              duration: 3000,
              gravity: "top",
              position: "right",
              backgroundColor: "#dc3545",
            }).showToast();
          }
        } catch (error) {
          console.error("Error:", error);

          // Cerrar el toast de carga y mostrar toast de error
          loadingToast.hideToast();
          Toastify({
            text: "Hubo un problema con la solicitud.",
            duration: 3000,
            gravity: "top",
            position: "right",
            backgroundColor: "#dc3545",
          }).showToast();
        }
      });
  </script>
</Layout>
